FROM eu.gcr.io/lunar-arc-236318/base-core
MAINTAINER Zalan Blenessy <zalan@radix.global>

# set entrypoint and default command
ENTRYPOINT [ "/opt/radixdlt/config_radixdlt.sh" ]
CMD ["/bin/bash", "-xe", "/opt/radixdlt/bin/radixdlt"]

# set default environment variables
ENV RADIXDLT_HOME=/home/radixdlt \
    RADIXDLT_API_FUNCTIONS=accounts,atoms,communications,graph,messages,network,system,transactions,universe \
    RADIXDLT_CP_PORT=8080 \
    RADIXDLT_DEBUG_PROFILER=false \
    RADIXDLT_NETWORK_CONNECTIONS_IN=5 \
    RADIXDLT_NETWORK_CONNECTIONS_OUT=5 \
    RADIXDLT_NETWORK_SEEDS_REMOTE=127.0.0.1 \
    RADIXDLT_PARTITION_FRAGMENTS=1 \
    RADIXDLT_UNIVERSE_WITNESSES_REMOTE=127.0.0.1 \
    RADIXDLT_UNIVERSE_WITNESSES=1 \
    RADIXDLT_UNIVERSE=v2djcmVhdG9yWCIBA3hanCWf3pmR5E+i+wtWWfKleBrDOQduLb/vcFKOSt9oa2Rlc2NyaXB0aW9ueB5UaGUgUmFkaXggZGV2ZWxvcG1lbnQgVW5pdmVyc2VnZ2VuZXNpc4G/aG1ldGFEYXRhv2l0aW1lc3RhbXBtMTU1MTIyNTYwMDAwMP9ucGFydGljbGVHcm91cHODv2lwYXJ0aWNsZXOBv2hwYXJ0aWNsZb9lYnl0ZXNXAVJhZGl4Li4uIGp1c3QgaW1hZ2luZSFsZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2Rmcm9tWCcEAgN4Wpwln96ZkeRPovsLVlnypXgawzkHbi2/73BSjkrfaIh5wbllbm9uY2UbAAAZ18WcRZ9qc2VyaWFsaXplcndyYWRpeC5wYXJ0aWNsZXMubWVzc2FnZWJ0b1gnBAIDeFqcJZ/emZHkT6L7C1ZZ8qV4GsM5B24tv+9wUo5K32iIecG5/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgH/anNlcmlhbGl6ZXJ0cmFkaXgucGFydGljbGVfZ3JvdXD/v2lwYXJ0aWNsZXODv2hwYXJ0aWNsZb9sZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2Vub25jZQBjcnJpWDkGL0pIMVA4ZjN6bmJ5ckRqOEY0UldwaXg3aFJrZ3hxSGpkVzJmTm5LcFIzdjZ1Zlhua25vci9YUkRqc2VyaWFsaXplcnNyYWRpeC5wYXJ0aWNsZXMucnJp/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbiD/v2hwYXJ0aWNsZb9nYWRkcmVzc1gnBAIDeFqcJZ/emZHkT6L7C1ZZ8qV4GsM5B24tv+9wUo5K32iIecG5a2Rlc2NyaXB0aW9uc1JhZGl4IE5hdGl2ZSBUb2tlbnNsZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2tncmFudWxhcml0eVghBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABZ2ljb25Vcmx4NGh0dHBzOi8vYXNzZXRzLnJhZGl4ZGx0LmNvbS9pY29ucy9pY29uLXhyZC0zMngzMi5wbmdkbmFtZWRSYWRza3Blcm1pc3Npb25zv2RidXJuZG5vbmVkbWludHN0b2tlbl9jcmVhdGlvbl9vbmx5/2pzZXJpYWxpemVyeCByYWRpeC5wYXJ0aWNsZXMudG9rZW5fZGVmaW5pdGlvbmZzeW1ib2xjWFJE/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgH/v2hwYXJ0aWNsZb9mYW1vdW50WCEF//////////////////////////////////////////9sZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2tncmFudWxhcml0eVghBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABZW5vbmNlGwAAGdfFnJpoa3Blcm1pc3Npb25zv2RidXJuZG5vbmVkbWludHN0b2tlbl9jcmVhdGlvbl9vbmx5/2pzZXJpYWxpemVyeCJyYWRpeC5wYXJ0aWNsZXMudW5hbGxvY2F0ZWRfdG9rZW5zeBh0b2tlbkRlZmluaXRpb25SZWZlcmVuY2VYOQYvSkgxUDhmM3puYnlyRGo4RjRSV3BpeDdoUmtneHFIamRXMmZObktwUjN2NnVmWG5rbm9yL1hSRP9qc2VyaWFsaXplcnNyYWRpeC5zcHVuX3BhcnRpY2xlZHNwaW4B/2pzZXJpYWxpemVydHJhZGl4LnBhcnRpY2xlX2dyb3Vw/79pcGFydGljbGVzg79ocGFydGljbGW/ZmFtb3VudFghBf//////////////////////////////////////////bGRlc3RpbmF0aW9uc4FRAlarqzhwWF8E0BXVWt9gC8drZ3JhbnVsYXJpdHlYIQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWVub25jZRsAABnXxZyaaGtwZXJtaXNzaW9uc79kYnVybmRub25lZG1pbnRzdG9rZW5fY3JlYXRpb25fb25sef9qc2VyaWFsaXplcngicmFkaXgucGFydGljbGVzLnVuYWxsb2NhdGVkX3Rva2Vuc3gYdG9rZW5EZWZpbml0aW9uUmVmZXJlbmNlWDkGL0pIMVA4ZjN6bmJ5ckRqOEY0UldwaXg3aFJrZ3hxSGpkVzJmTm5LcFIzdjZ1Zlhua25vci9YUkT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluIP+/aHBhcnRpY2xlv2ZhbW91bnRYIQX///////////////////////////zE0cNgL3/DF////2xkZXN0aW5hdGlvbnOBUQJWq6s4cFhfBNAV1VrfYAvHa2dyYW51bGFyaXR5WCEFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFlbm9uY2UbAAAZ18WdH6ZrcGVybWlzc2lvbnO/ZGJ1cm5kbm9uZWRtaW50c3Rva2VuX2NyZWF0aW9uX29ubHn/anNlcmlhbGl6ZXJ4InJhZGl4LnBhcnRpY2xlcy51bmFsbG9jYXRlZF90b2tlbnN4GHRva2VuRGVmaW5pdGlvblJlZmVyZW5jZVg5Bi9KSDFQOGYzem5ieXJEajhGNFJXcGl4N2hSa2d4cUhqZFcyZk5uS3BSM3Y2dWZYbmtub3IvWFJE/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgH/v2hwYXJ0aWNsZb9nYWRkcmVzc1gnBAIDeFqcJZ/emZHkT6L7C1ZZ8qV4GsM5B24tv+9wUo5K32iIecG5ZmFtb3VudFghBQAAAAAAAAAAAAAAAAAAAAAAAAAAAzsuPJ/QgDzoAAAAbGRlc3RpbmF0aW9uc4FRAlarqzhwWF8E0BXVWt9gC8drZ3JhbnVsYXJpdHlYIQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWVub25jZRsAABnXxZ0O7GtwZXJtaXNzaW9uc79kYnVybmRub25lZG1pbnRzdG9rZW5fY3JlYXRpb25fb25sef9mcGxhbmNrGgGKf0Bqc2VyaWFsaXplcngkcmFkaXgucGFydGljbGVzLnRyYW5zZmVycmFibGVfdG9rZW5zeBh0b2tlbkRlZmluaXRpb25SZWZlcmVuY2VYOQYvSkgxUDhmM3puYnlyRGo4RjRSV3BpeDdoUmtneHFIamRXMmZObktwUjN2NnVmWG5rbm9yL1hSRP9qc2VyaWFsaXplcnNyYWRpeC5zcHVuX3BhcnRpY2xlZHNwaW4B/2pzZXJpYWxpemVydHJhZGl4LnBhcnRpY2xlX2dyb3Vw/2pzZXJpYWxpemVyanJhZGl4LmF0b21qc2lnbmF0dXJlc794IDU2YWJhYjM4NzA1ODVmMDRkMDE1ZDU1YWRmNjAwYmM3v2FyWCEBP4HIrHPTyxZgYW68xgQI6HbtdFNj9wWBDVdurUVTJy1hc1ghATG3oUNe/QzU9lwMpAeZcvzTGmGSBwLH7FuLjUdCJOXzanNlcmlhbGl6ZXJ2Y3J5cHRvLmVjZHNhX3NpZ25hdHVyZWd2ZXJzaW9uGGT//210ZW1wb3JhbFByb29mv2NhaWRYIQgLYkPiLBXJTHUlx2NJ6ObfGx483FfUINJWq6s4cFhfBGpzZXJpYWxpemVydHRlbXBvLnRlbXBvcmFsX3Byb29mZ3ZlcnNpb24YZGh2ZXJ0aWNlc4G/ZWNsb2NrAWpjb21taXRtZW50WCEDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABlb3duZXJYIgEC2M/NwVW//nIoNzGw72peOq1V6jDPuVaYJfVyoSDkqdBocHJldmlvdXNRAgAAAAAAAAAAAAAAAAAAAABmcmNsb2NrGwAAAWksQDgAanNlcmlhbGl6ZXJ1dGVtcG8udGVtcG9yYWxfdmVydGV4aXNpZ25hdHVyZb9hclghAUPnd6D6dJXiubxqnz9qLpTFAbWK/BdyCt6apFnz6Th7YXNYIQFrCUK2VtC1bCEyMvxOK+iCak5310p3JbYzEx34RHHG0WpzZXJpYWxpemVydmNyeXB0by5lY2RzYV9zaWduYXR1cmVndmVyc2lvbhhk/2p0aW1lc3RhbXBzv2dkZWZhdWx0GwAAAWksQDgA/2d2ZXJzaW9uGGT///9lbWFnaWM6T2h//WRuYW1lbFJhZGl4IERldm5ldGZwbGFuY2sZ6mBkcG9ydBl1MGpzZXJpYWxpemVybnJhZGl4LnVuaXZlcnNla3NpZ25hdHVyZS5yWCEB5vPpmHKLqMT9Z0OZtdqZmeUUYMXnRgDknXdv9s3omFZrc2lnbmF0dXJlLnNYIQFdlTihr/GTCj6L6f1tLRIvOXZ9xAR1aMz+TLFuU6F6dWl0aW1lc3RhbXAbAAABaSxAOABkdHlwZQJndmVyc2lvbhhk/w==

# install the radixdlt package
COPY *.deb /tmp/
RUN dpkg -i /tmp/*.deb

# create configuration automatically when starting
COPY scripts/config_radixdlt.sh /opt/radixdlt/config_radixdlt.sh

# copy configuration templates
WORKDIR /home/radixdlt
COPY config/ /home/radixdlt/
RUN chown -R radixdlt:radixdlt /home/radixdlt/
