FROM radixdlt/base-core
MAINTAINER Radix Devops <devops@radixdlt.com>

# set entrypoint and default command
ENTRYPOINT [ "/opt/radixdlt/config_radixdlt.sh" ]
CMD ["/bin/bash", "-xe", "/opt/radixdlt/bin/radixdlt"]

# set default environment variables
ENV RADIXDLT_HOME=/home/radixdlt \
    RADIXDLT_API_FUNCTIONS=accounts,atoms,communications,graph,messages,network,system,transactions,universe \
    RADIXDLT_CP_PORT=8080 \
    RADIXDLT_DEBUG_PROFILER=false \
    RADIXDLT_NETWORK_CONNECTIONS_IN=5 \
    RADIXDLT_NETWORK_CONNECTIONS_OUT=5 \
    RADIXDLT_NETWORK_SEEDS_REMOTE=127.0.0.1 \
    RADIXDLT_PARTITION_FRAGMENTS=1 \
    RADIXDLT_UNIVERSE_WITNESSES_REMOTE=127.0.0.1 \
    RADIXDLT_UNIVERSE_WITNESSES=1 \
    RADIXDLT_PACEMAKER_TIMEOUT_MILLIS=5000 \
    RADIXDLT_CONSENSUS_START_ON_BOOT=true \
    RADIXDLT_UNIVERSE=v2djcmVhdG9yWCIBApv3kviax5wHBLCRRm5MPwvsdvWxHwZfmQUKyTM8P4OZa2Rlc2NyaXB0aW9ueB5UaGUgUmFkaXggZGV2ZWxvcG1lbnQgVW5pdmVyc2VnZ2VuZXNpc4G/bnBhcnRpY2xlR3JvdXBzgr9pcGFydGljbGVzgb9ocGFydGljbGW/ZWJ5dGVzVwFSYWRpeC4uLiBqdXN0IGltYWdpbmUhbGRlc3RpbmF0aW9uc4FRAt/XxIZXCnrUDrlIyAy4k3ZkZnJvbVgnBAICm/eS+JrHnAcEsJFGbkw/C+x29bEfBl+ZBQrJMzw/g5lhZXUoZW5vbmNlGwAAjfx2IP5/anNlcmlhbGl6ZXJ3cmFkaXgucGFydGljbGVzLm1lc3NhZ2VidG9YJwQCApv3kviax5wHBLCRRm5MPwvsdvWxHwZfmQUKyTM8P4OZYWV1KGd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluAWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJ0cmFkaXgucGFydGljbGVfZ3JvdXBndmVyc2lvbhhk/79pcGFydGljbGVzhL9ocGFydGljbGW/bGRlc3RpbmF0aW9uc4FRAt/XxIZXCnrUDrlIyAy4k3Zlbm9uY2UAY3JyaVg5Bi9KRkxLZVNRbUJaNzNZa3pXaWVzZEVyMmZSVDE0cUNCMURRVXZqOEt4WVFDNm04VVRDY0YvWFJEanNlcmlhbGl6ZXJzcmFkaXgucGFydGljbGVzLnJyaWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluIGd2ZXJzaW9uGGT/v2hwYXJ0aWNsZb9rZGVzY3JpcHRpb25zUmFkaXggTmF0aXZlIFRva2Vuc2xkZXN0aW5hdGlvbnOBUQLf18SGVwp61A65SMgMuJN2a2dyYW51bGFyaXR5WCEFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFnaWNvblVybHg0aHR0cHM6Ly9hc3NldHMucmFkaXhkbHQuY29tL2ljb25zL2ljb24teHJkLTMyeDMyLnBuZ2RuYW1lZFJhZHNrcGVybWlzc2lvbnO/ZGJ1cm5jYWxsZG1pbnRwdG9rZW5fb3duZXJfb25sef9jcnJpWDkGL0pGTEtlU1FtQlo3M1lreldpZXNkRXIyZlJUMTRxQ0IxRFFVdmo4S3hZUUM2bThVVENjRi9YUkRqc2VyaWFsaXplcngvcmFkaXgucGFydGljbGVzLm11dGFibGVfc3VwcGx5X3Rva2VuX2RlZmluaXRpb25jdXJseBlodHRwczovL3d3dy5yYWRpeGRsdC5jb20vZ3ZlcnNpb24YZP9qc2VyaWFsaXplcnNyYWRpeC5zcHVuX3BhcnRpY2xlZHNwaW4BZ3ZlcnNpb24YZP+/aHBhcnRpY2xlv2ZhbW91bnRYIQX///////////////////////////zE0cNgL3/DF////2xkZXN0aW5hdGlvbnOBUQLf18SGVwp61A65SMgMuJN2a2dyYW51bGFyaXR5WCEFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFlbm9uY2UbAACN/HYgoB9rcGVybWlzc2lvbnO/ZGJ1cm5jYWxsZG1pbnRwdG9rZW5fb3duZXJfb25sef9qc2VyaWFsaXplcngicmFkaXgucGFydGljbGVzLnVuYWxsb2NhdGVkX3Rva2Vuc3gYdG9rZW5EZWZpbml0aW9uUmVmZXJlbmNlWDkGL0pGTEtlU1FtQlo3M1lreldpZXNkRXIyZlJUMTRxQ0IxRFFVdmo4S3hZUUM2bThVVENjRi9YUkRndmVyc2lvbhhk/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgFndmVyc2lvbhhk/79ocGFydGljbGW/Z2FkZHJlc3NYJwQCApv3kviax5wHBLCRRm5MPwvsdvWxHwZfmQUKyTM8P4OZYWV1KGZhbW91bnRYIQUAAAAAAAAAAAAAAAAAAAAAAAAAAAM7Ljyf0IA86AAAAGxkZXN0aW5hdGlvbnOBUQLf18SGVwp61A65SMgMuJN2a2dyYW51bGFyaXR5WCEFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFlbm9uY2UbAACN/HYgqItrcGVybWlzc2lvbnO/ZGJ1cm5jYWxsZG1pbnRwdG9rZW5fb3duZXJfb25sef9qc2VyaWFsaXplcngkcmFkaXgucGFydGljbGVzLnRyYW5zZmVycmFibGVfdG9rZW5zeBh0b2tlbkRlZmluaXRpb25SZWZlcmVuY2VYOQYvSkZMS2VTUW1CWjczWWt6V2llc2RFcjJmUlQxNHFDQjFEUVV2ajhLeFlRQzZtOFVUQ2NGL1hSRGd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluAWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJ0cmFkaXgucGFydGljbGVfZ3JvdXBndmVyc2lvbhhk/2pzZXJpYWxpemVyanJhZGl4LmF0b21qc2lnbmF0dXJlc794IGRmZDdjNDg2NTcwYTdhZDQwZWI5NDhjODBjYjg5Mzc2v2FyWCEBAY5N348aY4yVwFDwRPAqXvzvmCWXiSESKZ91Bg154bZhc1ghAV+AmIsDKSMTUJLBgMKBjGs9KM8jX4SpYeaujiMdIJedanNlcmlhbGl6ZXJ2Y3J5cHRvLmVjZHNhX3NpZ25hdHVyZWd2ZXJzaW9uGGT//2d2ZXJzaW9uGGT/ZW1hZ2ljOkj8//1kbmFtZWxSYWRpeCBEZXZuZXRkcG9ydBl1MGpzZXJpYWxpemVybnJhZGl4LnVuaXZlcnNla3NpZ25hdHVyZS5yWCEBrboI9dli053q2B/mk81PGlIAGWWQkVb1XCUZh69s6EJrc2lnbmF0dXJlLnNYIQFfFZeSNrvYxINTN6diINvdfjeRSpZyol3wLOnYVhfTZ2l0aW1lc3RhbXAbAAABaSxAOABkdHlwZQJndmVyc2lvbhhk/w==

# install the radixdlt package
COPY *.deb /tmp/
RUN dpkg -i /tmp/*.deb

# create configuration automatically when starting
COPY scripts/config_radixdlt.sh /opt/radixdlt/config_radixdlt.sh

# copy configuration templates
WORKDIR /home/radixdlt
COPY config/ /home/radixdlt/
RUN chown -R radixdlt:radixdlt /home/radixdlt/
