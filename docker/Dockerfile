FROM eu.gcr.io/lunar-arc-236318/base-core
MAINTAINER Zalan Blenessy <zalan@radix.global>

# set entrypoint and default command
ENTRYPOINT [ "/opt/radixdlt/config_radixdlt.sh" ]
CMD ["/bin/bash", "-xe", "/opt/radixdlt/bin/radixdlt"]

# set default environment variables
ENV RADIXDLT_HOME=/home/radixdlt \
    RADIXDLT_API_FUNCTIONS=accounts,atoms,communications,graph,messages,network,system,transactions,universe \
    RADIXDLT_CP_PORT=8080 \
    RADIXDLT_DEBUG_PROFILER=false \
    RADIXDLT_NETWORK_CONNECTIONS_IN=5 \
    RADIXDLT_NETWORK_CONNECTIONS_OUT=5 \
    RADIXDLT_NETWORK_SEEDS_REMOTE=127.0.0.1 \
    RADIXDLT_PARTITION_FRAGMENTS=1 \
    RADIXDLT_UNIVERSE_WITNESSES_REMOTE=127.0.0.1 \
    RADIXDLT_UNIVERSE_WITNESSES=1 \
    RADIXDLT_UNIVERSE=v2djcmVhdG9yWCIBA3hanCWf3pmR5E+i+wtWWfKleBrDOQduLb/vcFKOSt9oa2Rlc2NyaXB0aW9ueB5UaGUgUmFkaXggZGV2ZWxvcG1lbnQgVW5pdmVyc2VnZ2VuZXNpc4G/aG1ldGFEYXRhv2l0aW1lc3RhbXBtMTU1MTIyNTYwMDAwMP9ucGFydGljbGVHcm91cHODv2lwYXJ0aWNsZXOBv2hwYXJ0aWNsZb9lYnl0ZXNXAVJhZGl4Li4uIGp1c3QgaW1hZ2luZSFsZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2Rmcm9tWCcEAgN4Wpwln96ZkeRPovsLVlnypXgawzkHbi2/73BSjkrfaIh5wbllbm9uY2UbAAAZMoAcrAtqc2VyaWFsaXplcndyYWRpeC5wYXJ0aWNsZXMubWVzc2FnZWJ0b1gnBAIDeFqcJZ/emZHkT6L7C1ZZ8qV4GsM5B24tv+9wUo5K32iIecG5/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgFndmVyc2lvbhhk/2pzZXJpYWxpemVydHJhZGl4LnBhcnRpY2xlX2dyb3VwZ3ZlcnNpb24YZP+/aXBhcnRpY2xlc4O/aHBhcnRpY2xlv2xkZXN0aW5hdGlvbnOBUQJWq6s4cFhfBNAV1VrfYAvHZW5vbmNlAGNycmlYOQYvSkgxUDhmM3puYnlyRGo4RjRSV3BpeDdoUmtneHFIamRXMmZObktwUjN2NnVmWG5rbm9yL1hSRGpzZXJpYWxpemVyc3JhZGl4LnBhcnRpY2xlcy5ycmn/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluIGd2ZXJzaW9uGGT/v2hwYXJ0aWNsZb9nYWRkcmVzc1gnBAIDeFqcJZ/emZHkT6L7C1ZZ8qV4GsM5B24tv+9wUo5K32iIecG5a2Rlc2NyaXB0aW9uc1JhZGl4IE5hdGl2ZSBUb2tlbnNsZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2tncmFudWxhcml0eVghBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABZ2ljb25Vcmx4NGh0dHBzOi8vYXNzZXRzLnJhZGl4ZGx0LmNvbS9pY29ucy9pY29uLXhyZC0zMngzMi5wbmdkbmFtZWRSYWRza3Blcm1pc3Npb25zv2RidXJuZG5vbmVkbWludHN0b2tlbl9jcmVhdGlvbl9vbmx5/2pzZXJpYWxpemVyeCByYWRpeC5wYXJ0aWNsZXMudG9rZW5fZGVmaW5pdGlvbmZzeW1ib2xjWFJE/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgFndmVyc2lvbhhk/79ocGFydGljbGW/ZmFtb3VudFghBf//////////////////////////////////////////bGRlc3RpbmF0aW9uc4FRAlarqzhwWF8E0BXVWt9gC8drZ3JhbnVsYXJpdHlYIQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWVub25jZRsAABkygB0epWtwZXJtaXNzaW9uc79kYnVybmRub25lZG1pbnRzdG9rZW5fY3JlYXRpb25fb25sef9qc2VyaWFsaXplcngicmFkaXgucGFydGljbGVzLnVuYWxsb2NhdGVkX3Rva2Vuc3gYdG9rZW5EZWZpbml0aW9uUmVmZXJlbmNlWDkGL0pIMVA4ZjN6bmJ5ckRqOEY0UldwaXg3aFJrZ3hxSGpkVzJmTm5LcFIzdjZ1Zlhua25vci9YUkT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluAWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJ0cmFkaXgucGFydGljbGVfZ3JvdXBndmVyc2lvbhhk/79pcGFydGljbGVzg79ocGFydGljbGW/ZmFtb3VudFghBf//////////////////////////////////////////bGRlc3RpbmF0aW9uc4FRAlarqzhwWF8E0BXVWt9gC8drZ3JhbnVsYXJpdHlYIQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWVub25jZRsAABkygB0epWtwZXJtaXNzaW9uc79kYnVybmRub25lZG1pbnRzdG9rZW5fY3JlYXRpb25fb25sef9qc2VyaWFsaXplcngicmFkaXgucGFydGljbGVzLnVuYWxsb2NhdGVkX3Rva2Vuc3gYdG9rZW5EZWZpbml0aW9uUmVmZXJlbmNlWDkGL0pIMVA4ZjN6bmJ5ckRqOEY0UldwaXg3aFJrZ3hxSGpkVzJmTm5LcFIzdjZ1Zlhua25vci9YUkT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluIGd2ZXJzaW9uGGT/v2hwYXJ0aWNsZb9mYW1vdW50WCEF///////////////////////////8xNHDYC9/wxf///9sZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2tncmFudWxhcml0eVghBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABZW5vbmNlGwAAGTKAHccba3Blcm1pc3Npb25zv2RidXJuZG5vbmVkbWludHN0b2tlbl9jcmVhdGlvbl9vbmx5/2pzZXJpYWxpemVyeCJyYWRpeC5wYXJ0aWNsZXMudW5hbGxvY2F0ZWRfdG9rZW5zeBh0b2tlbkRlZmluaXRpb25SZWZlcmVuY2VYOQYvSkgxUDhmM3puYnlyRGo4RjRSV3BpeDdoUmtneHFIamRXMmZObktwUjN2NnVmWG5rbm9yL1hSRP9qc2VyaWFsaXplcnNyYWRpeC5zcHVuX3BhcnRpY2xlZHNwaW4BZ3ZlcnNpb24YZP+/aHBhcnRpY2xlv2dhZGRyZXNzWCcEAgN4Wpwln96ZkeRPovsLVlnypXgawzkHbi2/73BSjkrfaIh5wblmYW1vdW50WCEFAAAAAAAAAAAAAAAAAAAAAAAAAAADOy48n9CAPOgAAABsZGVzdGluYXRpb25zgVECVqurOHBYXwTQFdVa32ALx2tncmFudWxhcml0eVghBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABZW5vbmNlGwAAGTKAHYgsa3Blcm1pc3Npb25zv2RidXJuZG5vbmVkbWludHN0b2tlbl9jcmVhdGlvbl9vbmx5/2ZwbGFuY2saAYp/QGpzZXJpYWxpemVyeCRyYWRpeC5wYXJ0aWNsZXMudHJhbnNmZXJyYWJsZV90b2tlbnN4GHRva2VuRGVmaW5pdGlvblJlZmVyZW5jZVg5Bi9KSDFQOGYzem5ieXJEajhGNFJXcGl4N2hSa2d4cUhqZFcyZk5uS3BSM3Y2dWZYbmtub3IvWFJE/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgFndmVyc2lvbhhk/2pzZXJpYWxpemVydHJhZGl4LnBhcnRpY2xlX2dyb3VwZ3ZlcnNpb24YZP9qc2VyaWFsaXplcmpyYWRpeC5hdG9tanNpZ25hdHVyZXO/eCA1NmFiYWIzODcwNTg1ZjA0ZDAxNWQ1NWFkZjYwMGJjN79hclghAUN1Cjyjk6SCcqVb6YwTedBJkWuufCoctSajr8vSvKcJYXNYIQEPlHVxtsLKbikfSiy6IVCNFgKieBRKTi3PN5hG8d5kx2pzZXJpYWxpemVydmNyeXB0by5lY2RzYV9zaWduYXR1cmVndmVyc2lvbhhk//9tdGVtcG9yYWxQcm9vZr9jYWlkWCEIAiW0T9MCBFmAY5BxpCUEBalVZ9+/NqFQVqurOHBYXwRqc2VyaWFsaXplcnR0ZW1wby50ZW1wb3JhbF9wcm9vZmd2ZXJzaW9uGGRodmVydGljZXOBv2VjbG9jawFqY29tbWl0bWVudFghAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZW93bmVyWCIBAtjPzcFVv/5yKDcxsO9qXjqtVeowz7lWmCX1cqEg5KnQaHByZXZpb3VzUQIAAAAAAAAAAAAAAAAAAAAAZnJjbG9jaxsAAAFpLEA4AGpzZXJpYWxpemVydXRlbXBvLnRlbXBvcmFsX3ZlcnRleGlzaWduYXR1cmW/YXJYIQGZIPSUPFB21FlFrScb+nRdhCxCBCVWu6qf3Hr/LL5wmmFzWCEBb7aW9wAzAQKSW4kmVA2R/JmjaR9VxG0FD0jcV809N5lqc2VyaWFsaXplcnZjcnlwdG8uZWNkc2Ffc2lnbmF0dXJlZ3ZlcnNpb24YZP9qdGltZXN0YW1wc79nZGVmYXVsdBsAAAFpLEA4AP9ndmVyc2lvbhhk////ZW1hZ2ljOk9of/1kbmFtZWxSYWRpeCBEZXZuZXRmcGxhbmNrGepgZHBvcnQZdTBqc2VyaWFsaXplcm5yYWRpeC51bml2ZXJzZWtzaWduYXR1cmUuclghAbX2a8qjW6w5Z9GHaue32/arFzlOPIm+HA/X9GlPO7+ka3NpZ25hdHVyZS5zWCEBJTpnOoT4vP0UyYFW2kRVfr3kXPScpfdv8votNKjQDoFpdGltZXN0YW1wGwAAAWksQDgAZHR5cGUCZ3ZlcnNpb24YZP8=

# install the radixdlt package
COPY *.deb /tmp/
RUN dpkg -i /tmp/*.deb

# create configuration automatically when starting
COPY scripts/config_radixdlt.sh /opt/radixdlt/config_radixdlt.sh

# copy configuration templates
WORKDIR /home/radixdlt
COPY config/ /home/radixdlt/
RUN chown -R radixdlt:radixdlt /home/radixdlt/
