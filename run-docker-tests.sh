#!/bin/bash
# This script represents commands that can be used to run tests locally on development laptop and also on jenkins
set -x
test_executor="${TEST_EXECUTOR:-test-executor}"
echo "Test executor Container Name = $test_executor"
echo "Duration of individual tests = $TEST_DURATION"
docker build -f system-tests/docker/Dockerfile -t radix-system-test .
docker ps -a
export RADIXDLT_UNIVERSE=v2djcmVhdG9yWCIBA+QmsR/M7noxMUGoo1Ud65r5etGbWYtzusdzpxQjXrLna2Rlc2NyaXB0aW9ueB5UaGUgUmFkaXggZGV2ZWxvcG1lbnQgVW5pdmVyc2VnZ2VuZXNpc4G/bnBhcnRpY2xlR3JvdXBzgr9pcGFydGljbGVzgb9ocGFydGljbGW/ZWJ5dGVzVwFSYWRpeC4uLiBqdXN0IGltYWdpbmUhbGRlc3RpbmF0aW9uc4FRAuxIrue0+Y2up8UWlrnGBmhkZnJvbVgnBAID5CaxH8zuejExQaijVR3rmvl60ZtZi3O6x3OnFCNesufothLNZW5vbmNlGwACBXQuF9hianNlcmlhbGl6ZXJ3cmFkaXgucGFydGljbGVzLm1lc3NhZ2VidG9YJwQCA+QmsR/M7noxMUGoo1Ud65r5etGbWYtzusdzpxQjXrLn6LYSzWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluAWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJ0cmFkaXgucGFydGljbGVfZ3JvdXBndmVyc2lvbhhk/79pcGFydGljbGVzhL9ocGFydGljbGW/bGRlc3RpbmF0aW9uc4FRAuxIrue0+Y2up8UWlrnGBmhlbm9uY2UAY3JyaVg5Bi9KSHByZmZnUWFuamhyeGpRUzg0UW9KQ0J0RU1MSGVCdG1HRTZlMmYxeDY2eVFHMllhVTQvWFJEanNlcmlhbGl6ZXJzcmFkaXgucGFydGljbGVzLnJyaWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluIGd2ZXJzaW9uGGT/v2hwYXJ0aWNsZb9rZGVzY3JpcHRpb25zUmFkaXggTmF0aXZlIFRva2Vuc2xkZXN0aW5hdGlvbnOBUQLsSK7ntPmNrqfFFpa5xgZoa2dyYW51bGFyaXR5WCEFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFnaWNvblVybHg0aHR0cHM6Ly9hc3NldHMucmFkaXhkbHQuY29tL2ljb25zL2ljb24teHJkLTMyeDMyLnBuZ2RuYW1lZFJhZHNrcGVybWlzc2lvbnO/ZGJ1cm5jYWxsZG1pbnRwdG9rZW5fb3duZXJfb25sef9jcnJpWDkGL0pIcHJmZmdRYW5qaHJ4alFTODRRb0pDQnRFTUxIZUJ0bUdFNmUyZjF4NjZ5UUcyWWFVNC9YUkRqc2VyaWFsaXplcngvcmFkaXgucGFydGljbGVzLm11dGFibGVfc3VwcGx5X3Rva2VuX2RlZmluaXRpb25jdXJseBlodHRwczovL3d3dy5yYWRpeGRsdC5jb20vZ3ZlcnNpb24YZP9qc2VyaWFsaXplcnNyYWRpeC5zcHVuX3BhcnRpY2xlZHNwaW4BZ3ZlcnNpb24YZP+/aHBhcnRpY2xlv2dhZGRyZXNzWCcEAgPkJrEfzO56MTFBqKNVHeua+XrRm1mLc7rHc6cUI16y5+i2Es1mYW1vdW50WCEFAAAAAAAAAAAAAAAAAAAAAAAAAAADOy48n9CAPOgAAABsZGVzdGluYXRpb25zgVEC7Eiu57T5ja6nxRaWucYGaGtncmFudWxhcml0eVghBQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABZW5vbmNlGwACBXQuCpoga3Blcm1pc3Npb25zv2RidXJuY2FsbGRtaW50cHRva2VuX293bmVyX29ubHn/anNlcmlhbGl6ZXJ4JHJhZGl4LnBhcnRpY2xlcy50cmFuc2ZlcnJhYmxlX3Rva2Vuc3gYdG9rZW5EZWZpbml0aW9uUmVmZXJlbmNlWDkGL0pIcHJmZmdRYW5qaHJ4alFTODRRb0pDQnRFTUxIZUJ0bUdFNmUyZjF4NjZ5UUcyWWFVNC9YUkRndmVyc2lvbhhk/2pzZXJpYWxpemVyc3JhZGl4LnNwdW5fcGFydGljbGVkc3BpbgFndmVyc2lvbhhk/79ocGFydGljbGW/ZmFtb3VudFghBf///////////////////////////MTRw2Avf8MX////bGRlc3RpbmF0aW9uc4FRAuxIrue0+Y2up8UWlrnGBmhrZ3JhbnVsYXJpdHlYIQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWVub25jZRsAAgV0LgxRJmtwZXJtaXNzaW9uc79kYnVybmNhbGxkbWludHB0b2tlbl9vd25lcl9vbmx5/2pzZXJpYWxpemVyeCJyYWRpeC5wYXJ0aWNsZXMudW5hbGxvY2F0ZWRfdG9rZW5zeBh0b2tlbkRlZmluaXRpb25SZWZlcmVuY2VYOQYvSkhwcmZmZ1FhbmpocnhqUVM4NFFvSkNCdEVNTEhlQnRtR0U2ZTJmMXg2NnlRRzJZYVU0L1hSRGd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJzcmFkaXguc3B1bl9wYXJ0aWNsZWRzcGluAWd2ZXJzaW9uGGT/anNlcmlhbGl6ZXJ0cmFkaXgucGFydGljbGVfZ3JvdXBndmVyc2lvbhhk/2pzZXJpYWxpemVyanJhZGl4LmF0b21qc2lnbmF0dXJlc794IGVjNDhhZWU3YjRmOThkYWVhN2M1MTY5NmI5YzYwNjY4v2FyWCEBUEqRAKTMDBc8ZAe+sU6Yja+fzGRh/zARCVTle4pz2gNhc1ghAVqD3MQVBIiPorOTvWSgpLlZzaPYI1mOK6YUzTjRAoVPanNlcmlhbGl6ZXJ2Y3J5cHRvLmVjZHNhX3NpZ25hdHVyZWd2ZXJzaW9uGGT//2d2ZXJzaW9uGGT/ZW1hZ2ljGhFgAAJkbmFtZWxSYWRpeCBEZXZuZXRkcG9ydBl1MGpzZXJpYWxpemVybnJhZGl4LnVuaXZlcnNla3NpZ25hdHVyZS5yWCEBmb037fkGP0c/fjC39FVIP7fZUxCdZtYvPG5MP0iBBUJrc2lnbmF0dXJlLnNYIQFdIM9ENam2Y5ziOdIvAqfhM9KjgnNI0jsyktyTr9IJDml0aW1lc3RhbXAbAAWbCMH6QABkdHlwZQJndmVyc2lvbhhk/w==
echo $RADIXDLT_UNIVERSE
docker rm -f "${test_executor}" || true
docker create  --pid=host --privileged  \
      -v /var/run/docker.sock:/var/run/docker.sock \
      --network=host --cap-add=NET_ADMIN  \
      -e CONTAINER_NAME -e TEST_DURATION -e RADIXDLT_UNIVERSE=${RADIXDLT_UNIVERSE} \
      --name=${test_executor} radix-system-test \
#      ./gradlew clean dockerSystemTests --tests "OutOfSynchronyBoundsTest.given_4_correct_bfts_in_latent_docker_network__when_one_instance_is_down__then_all_instances_should_get_same_commits_and_progress_should_be_made"
      ./gradlew clean dockerSystemTests
docker start -a "${test_executor}"
docker cp $test_executor:src/system-tests .